---
title: "Markdown文法の基礎"
modified-date: today
format: html
metadata-files: 
  - "style/exercise.yml"
---

{{< revealjs file="03_markdown_slide.html" height="900px" class="ratio ratio-4x3" full-screen-link="true">}}

```{scss}
//| echo: false
figcaption {
  text-align: center;
}
a {
  color: royalblue;
  text-decoration: none;
}
```

# Markdownによる文書構造

## 文字の装飾と強調

文章の一部を強調したい場合、以下のような記法が使えます。

- **太字（Bold）**: ローマ字以外の強調に使います。
- *イタリック（Italic）*: ローマ字の強調に使います。
- ~~取り消し線（Strike）~~: 削除された情報を表現します。
- <u>下線（Underline）</u>: HTMLタグを使って表現します。

## リストの作成

### 順序なしリスト（箇条書き）

項目の並列な羅列に使います。インデント（字下げ）で階層化できます。

* データ分析の準備
   + データの収集
   + データの整形
      - 欠損値の処理
      - 異常値の確認
* 分析の実行

### 順序ありリスト（番号付き）

手順やランキングなど、順序が重要な場合に使います。

1. RStudioを開く
1. プロジェクトを作成する
   1. New Projectを選択
   1. ディレクトリを指定
1. Quartoファイルを作成する

### タスクリスト

進捗管理などに便利です。

- [x] テーマの決定
- [x] 資料の収集
- [ ] レポートの執筆（現在進行中）

## リンクと脚注

外部サイトへの誘導にはリンクを使います。[Quartoの公式ドキュメント](https://quarto.org)などは頻繁に参照します。
また、本文の流れを妨げずに補足情報を入れたい場合は、脚注を利用します^[脚注は、ページ下部や文末にまとめて表示されます。]。

識別子を使った脚注も可能です[^note1]。

[^note1]: 識別子を使うと、長い脚注を書きやすくなります。識別子を使わない脚注はマークダウンのコード基準、1行に1回しか使えませんが、識別子を使う方法は複数回使えます。

---

# 高度なレイアウト表現

## 表の作成

Markdownで表を作成するには、パイプ（`|`）とハイフン（`-`）を使用します。コロン（`:`）の位置で配置を指定できます。

| ID | 名前 | スコア | 備考 |
|--:|:---|:---:|:---|
| 1 | 佐藤 | 95 | 右寄せ・左寄せの例 |
| 2 | 田中 | 82 | **強調**も可能 |
| 3 | 鈴木 | 100 | 中央揃え |

: 表1: 成績一覧表のサンプル

## 画像の埋め込みとサイズ調整

画像の表示サイズは `width` や `height` オプションで制御できます。

**標準サイズ:**

![R猫](figs/rcat.png)

**サイズ指定（幅75pxに縮小）:**

![小さくてかわいいR猫](figs/rcat.png){width="75px"}

## 数式の記述 

レポートに数式を含める場合、LaTeX記法が使えます。

**文中の数式（インライン）:**

回帰分析のモデルは $y = \beta_0 + \beta_1 x + \varepsilon$ で表されます。

**独立した数式ブロック（ディスプレイ）:**

$$
f(x) = \frac{1}{\sqrt{2\pi\sigma^2}} \exp\left( -\frac{(x-\mu)^2}{2\sigma^2} \right)
$$

## 複数コンテンツのレイアウト

`layout-ncol` 属性を使うと、画像や表を横に並べて配置できます。比較を行う際に非常に強力です。

::: {layout-ncol=2}
![R猫零号機](figs/markdown/rcat_0.png)

![R猫初号機](figs/markdown/rcat_1.png)
:::

::: {layout-ncol=2}
### グループA
| 項目 | 値 |
|:---|---:|
| 平均 | 50 |
| 分散 | 10 |

### グループB
| 項目 | 値 |
|:---|---:|
| 平均 | 65 |
| 分散 | 15 |
:::

---

# Rコードの挿入

Quartoの最大の特徴は、ドキュメント内でRのコードを実行し、その結果を直接ドキュメントに反映できる点です。

## 基本的なコード実行

以下は標準的なコードチャンクです。コードと結果の両方が表示されます。

```{r}
#| label: basic-calculation
# 1から10までの整数の合計を計算
x <- 1:10
sum(x)
```

**インラインコード:**

文章の中に計算結果を埋め込むこともできます。
例えば、計算された合計値は`r sum(x)`です。

## チャンク・オプション

目的に応じて、コードや結果の表示・非表示を切り替えられます。チャンクオプションはチャンクの最上段に`#| オプション名: 引数`の書き方で記入します。チャンク・オプションは複数指定することができます。

**ケース1:** 結果だけ見せたい (echo: false)

読者にコードを見せる必要がなく、グラフや表だけを示したい場合に使います。

```{r}
#| label: show-plot-only
#| echo: false
#| fig-cap: "正規乱数のヒストグラム（コードは非表示）"

# 実際にはここでデータを生成して描画しています
data <- rnorm(100)
hist(data, main="Distribution", col="skyblue")
```

**ケース2:** コードだけ見せたい（`eval: false`）

実行に時間がかかるコードや、解説用のコードを示す場合に便利です。

```{r}
#| eval: false
# このコードは表示されますが、実行はされません
install.packages("very_heavy_package")
start_simulation()
```

**ケース3:** コードと結果をまとめる（`collapse: true`）

Rコンソールのように、コードと出力結果を一つのブロックにまとめます。

```{r}
#| collapse: true
print("Hello, Quarto!")
mean(c(10, 20, 30))
```

## エラー処理

通常、コードにエラーがあると文書生成（レンダー）は止まりますが、`error: true`を指定しておくと、エラーメッセージを表示して処理を続行します。デバッグ内容をレポートする場合に使います。

```{r}
#| error: true
# 存在しない変数を呼び出してみる
print(undefined_variable)
```

---

# チャンクの表示

```` ```{r} ````の代わりに```` ```{{r}} ````を使用すると、チャンクごとに表示されます。ただし、チャンク内のコードは実行されません。Quarto教育用の教材作成時以外はあまり出番がないかも知れません。

```{{r}}
print("Hello, Quarto!")
```

マークダウン文書のコードとチャンクを同時に入れるためには、されに````` ````{.markdown} `````と````` ```` `````で囲みます。

````{.markdown}
- マークダウンのコードを見せる。
- チャンクもそのまま見せる

```{{r}}
print("Hello, Quarto!")
```
````

---

# 図表の高度な配置

図のキャプション、参照、そして複雑なレイアウト設定について学びます。

## 図の参照とキャプション

チャンクオプションで`fig-cap`（キャプション）と`label`（ラベル）を設定すると、本文中で「図1を参照」のように自動採番付きで参照できます。

以下の @fig-scatter をご覧ください。

```{r}
#| label: fig-scatter
#| fig-cap: "車の速度と停止距離の関係（散布図）"
#| fig-width: 6
#| fig-height: 4

plot(cars, pch=19, col="darkorange")
```

## サブキャプションと並列配置

一つのチャンクから複数のグラフを出力し、それぞれにサブキャプションを付けることもできます。

```{r}
#| label: tbl-panels
#| layout-ncol: 2
#| tbl-cap: "irisデータセットの中身"
#| tbl-subcap: 
#|   - "setosa種"
#|   - "virginica種"

gt::gt(head(iris[iris$Species == "setosa", 1:4]))

gt::gt(head(iris[iris$Species == "virginica", 1:4]))
```

## カスタムレイアウト

layout オプションを使うと、「上段に2つ、下段に1つ」といった複雑な配置も可能です。

指定例: 上段は50%-50%、下段は100%

```{r}
#| label: fig-three-figs
#| fig-cap: 図3つの配置の例
#| fig-subcap: 
#|   - 図A
#|   - 図B
#|   - 図C
#| layout: [[50, 50], [100]]
#| echo: false

# 左上
plot(1:10, main="Plot A")
# 右上
plot(10:1, main="Plot B")
# 下段（幅広）
plot(rnorm(50), type="l", main="Plot C (Wide)", col="red")
```
